<abi>  

    <types>
        parameters#_  discount:uint32 rebate:uint32 = Parameters;

        update_msg#_ price:Coins spread:Coins timestamp:uint32 asset_index:uint16 = UpdateMsg;
                                                                                 
        <!-- signatures#_ has_sig:uint1  = Signatures; -->

        oracle_data#_ update_msg:^UpdateMsg signatures:^Cell = OracleData;

        amm_settings#_ fee:uint32 rollover_fee:uint32 funding_period:uint32 init_margin_ratio:uint32 
        maintenance_margin_ratio:uint32 liquidation_fee_ratio:uint32 partial_liquidation_ratio:uint32 
        spread_limit:uint32 max_price_impact:uint32 max_price_spread:uint32 max_open_notional:uint32 
        fee_to_stakers_percent:uint32 funding_mode:uint2 min_partial_liquidation_notional:Coins min_leverage:uint32 = AmmSettings;

        referral_data#_ amount:Coins index:uint32 = ReferralData;
        executor_data#_ split_executor_rewards:uint8 amount:Coins index:uint32 = ExecutorData;

        notification_payload#_ opcode:uint64 = NotificationPayload;

    </types>

    <!-- INTERFACES -->

    <interface name="storm_vamm">
        <get_method name="get_amm_name" version="storm"/>
        <get_method name="get_amm_status" version="storm"/>
        <msg_in>
            <internal name="storm_change_settings"/>
            <internal name="storm_pay_funding"/>  <!--- test -->
            <internal name="storm_vamm_init"/>
        </msg_in>
        <msg_out>
            <internal name="storm_update"/>
        </msg_out>
    </interface>

    <interface name="storm_referral">
        <msg_in>
            <internal name="storm_mint_referral"/>
            <internal name="storm_add_referral_amount"/>
            <internal name="storm_nft_item_transfer"/>
            <internal name="storm_nft_item_get_static_data"/>
            <internal name="storm_nft_item_ownership_assigned"/>
        </msg_in>
    </interface>


    <interface name="storm_vault">
        <msg_in>
            <internal name="storm_exchange"/>
            <internal name="storm_transfer_notification"/>
            <internal name="storm_stake"/>
            <internal name="storm_unstake"/>

            <internal name="storm_vault_init"/>

        </msg_in>
    </interface>

    
    <!-- GET METHODS -->
    
    <get_method name="get_amm_contract_data">
        <output>
            <cell name="amm_contract_data">cell</cell>
        </output>
    </get_method>

    <get_method name="get_amm_name">
        <output>
            <slice name="vault_addr">msgaddress</slice>
            <int name="asset_id">uint16</int>
        </output>
    </get_method>


    <get_method name="get_amm_status">
        <output>
            <int name="close_only">bool</int>
            <int name="paused">bool</int>
            <int name="direct_increase_enabled">bool</int>
        </output>
    </get_method>

    <get_method name="get_amm_state">
        <output>

            <int name="quote_asset_reserve">uint64</int>
            <int name="base_asset_reserve">uint64</int>
            <int name="quote_asset_weight">uint64</int>
            <int name="total_long_position_size">uint64</int>
            <int name="total_short_position_size">uint64</int>
            
            <int name="open_interest_long">uint64</int>
            <int name="open_interest_short">uint64</int>
            <int name="latest_long_cumulative_premium_fraction">int64</int>
            <int name="latest_short_cumulative_premium_fraction">int64</int>
            <int name="next_funding_block_timestamp">uint32</int>
        </output>
    </get_method>


    <get_method name="get_exchange_settings">
        <output>
            <int name="fee">uint32</int>
            <int name="rollover_fee">uint32</int>
            <int name="funding_period">uint32</int>
            <int name="init_margin_ratio">uint32</int>
            <int name="maintenance_margin_ratio">uint32</int>
            <int name="liquidation_fee_ratio">uint32</int>
            <int name="partial_liquidation_ratio">uint32</int>
            <int name="spread_limit">uint32</int>
            <int name="max_price_impact">uint32</int>
            <int name="max_price_spread">uint32</int>
            <int name="max_open_notional">uint64</int>
            <int name="fee_to_stakers_percent">uint32</int>
            <int name="funding_mode">uint32</int>
            <int name="min_partial_liquidation_notional">uint64</int>
            <int name="min_init_margin_ratio">uint32</int>

            <int name="executor_fee">int32</int>
            <int name="close_position_time_delta">int32</int>
            <int name="max_unrealized_pnl">int32</int>

            <int name="direct_increase_enabled">bool</int>
            <int name="direct_close_enabled">bool</int>
            <cell name="executors_whitelist">cell</cell>

            <int name="low_funding_fn_a">int32</int>
            <int name="low_funding_fn_b">int32</int>
            <int name="high_funding_fn_a">int32</int>
            <int name="high_funding_fn_b">int32</int>

            <int name="inflection_point">int32</int>

        </output>
    </get_method>

    <get_method name="get_spot_price">
        <output>
            <int name="spot_price">int64</int>
        </output>
    </get_method>

    
    <get_method name="get_executor_vaults_whitelist">
        <output>
            <int name="balances_dict">int64</int> <!-- int64 ??? -->
        </output>
    </get_method>


    <!-- INTERNALS -->


    <internal name="storm_change_settings">
        change_settings#edcd36a6 redirect_addr:MsgAddress 
        settings:^AmmSettings = InternalMsgBody;
    </internal>

    <internal name="storm_pay_funding">
        pay_funding#b652c441 oracle_ref:^OracleData = InternalMsgBody;
    </internal>

    <internal name="storm_vamm_init">
        init#29c102d1 redirect_addr:MsgAddress 
        code:^Cell data:^Cell = InternalMsgBody;
    </internal>

    <internal name="storm_update">
        update#e434967e origin_opcode:uint32 = InternalMsgBody;
    </internal>

    <internal name="storm_mint_referral">
        mint_referral#cb4ddc3c nft_owner:MsgAddress ref_type:uint2
        redirect_address:MsgAddress parameters:^Parameters balances_dict:^Cell = InternalMsgBody;
    </internal>

    <internal name="storm_add_referral_amount">
        add_referral_amount#84dced7a referral_amount:Coins origin_addr:MsgAddress = InternalMsgBody;
    </internal>

    <internal name="storm_nft_item_transfer">
        nft_item_transfer#5fcc3d14 query_id:uint64 new_owner:MsgAddress response_destination:MsgAddress
        custom_payload:(Maybe ^Cell) forward_amount:Coins forward_payload:(Either Cell ^Cell) = InternalMsgBody;
    </internal>

    <internal name="storm_nft_item_get_static_data"> <!-- hard to find boc for test -->
        nft_item_get_static_data#2fcb26a2 query_id:uint64 = InternalMsgBody;
    </internal>

    
    <internal name="storm_nft_item_ownership_assigned"> <!-- hard to find boc for test -->
        nft_item_ownership_assigned#05138d91 query_id:uint64 prev_owner:MsgAddress forward_payload:(Either Cell ^Cell) = InternalMsgBody;
    </internal>



    <internal name="storm_exchange">
        exchange#3475fdd2 amm_index:uint16 free_amount:uint16 locked_amount:int64 exchange_amount:int64 withdraw_locked_amount:int64
        fee_to_stakers:int64 withdraw_amount:int64 trader_addr:MsgAddress referral_params:(Maybe ^ReferralData) executor_params:(Maybe ^ExecutorData) = InternalMsgBody;
    </internal>


    <internal name="storm_transfer_notification">
        transfer_notification#7362d09c query_id:uint64 amount:Coins 
        sender:MsgAddress forward_payload:(Either NotificationPayload ^NotificationPayload) = InternalMsgBody;
    </internal>

    <internal name="storm_stake">
        stake#c89a3ee4 amount:Coins = InternalMsgBody;
    </internal>

    <internal name="storm_unstake">
        unstake#d5b5e9ad jetton_amount:Coins user_address:MsgAddress = InternalMsgBody;
    </internal>


    <internal name="storm_vault_init">
        vault_init#29c102d1 jetton_address:MsgAddress = InternalMsgBody;
    </internal>




</abi>