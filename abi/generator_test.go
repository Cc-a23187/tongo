package abi

import (
	"fmt"
	"github.com/startfellows/tongo/abi/parser"
	"os"
	"testing"
)

func TestGen(t *testing.T) {
	scheme, err := os.ReadFile("known.xml")
	if err != nil {
		panic(err)
	}
	interfaces, err := parser.ParseInterface(scheme)
	if err != nil {
		panic(err)
	}

	gen := parser.NewGenerator(nil, "test")

	err = gen.RegisterTypes(interfaces)

	types := gen.CollectedTypes()
	if err != nil {
		panic(err)
	}

	msgDecoder := gen.GenerateMsgDecoder()

	getMethods, err := gen.GetMethods(interfaces)
	if err != nil {
		panic(err)
	}

	f, err := os.Create("generated.go")
	if err != nil {
		panic(err)
	}
	_, err = fmt.Fprint(f, `package abi
// Code autogenerated. DO NOT EDIT. 

import (
	"context"
	"fmt"
	"github.com/startfellows/tongo"
	"github.com/startfellows/tongo/boc"
	"github.com/startfellows/tongo/tlb"
)

`)
	if err != nil {
		panic(err)
	}
	_, err = f.WriteString(types)
	if err != nil {
		panic(err)
	}
	_, err = f.WriteString(msgDecoder)
	if err != nil {
		panic(err)
	}
	_, err = f.WriteString(getMethods)
	if err != nil {
		panic(err)
	}
}
